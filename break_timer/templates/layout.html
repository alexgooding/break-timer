<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        {% load static %}
        <link rel="stylesheet" type="text/css" href="{% static 'break-timer.css' %}"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script type="text/javascript" src="{% static 'break-timer.js' %}"></script>
    </head>
    <body>
        <div class="body-content">
            {% block content %}
            {% endblock %}
        </div>
        <div id="navigation-bar">
            {% block navbar %}
            {% endblock %}
            <div id="mute-button" class="navigation-bar-element">
                <label>
                    <input type="checkbox" onclick="toggleMute()" id="mute-button-checkbox" {% if request.session.mute_state == 'true' %}checked{% endif %}>
                    <span class="label"></span>
                </label>
            </div>
            {% if user.is_authenticated %}
            <div id="logout-button" class="navigation-bar-element">
                <a href="{% url 'logout' %}">Logout</a>
            </div>
            {% else %}
            <div id="login-button" class="navigation-bar-element">
                <a href="{% url 'login' %}">Login</a>
            </div>
            <div id="signup-button" class="navigation-bar-element">
                <a href="{% url 'signup' %}">Signup</a>
            </div>
            {% endif %}
        </div>
    </body>
    <script>
        function toggleMute() {
            let muteCheckbox = document.getElementById('mute-button-checkbox');
            let muteState = muteCheckbox.checked
            $.post('{% url "mute" %}', {'mute_state': muteState})
            .fail(function(jqXHR, textStatus, errorThrown) {
                console.log('Failed to update mute state:', errorThrown);
            });
            document.querySelectorAll("audio").forEach(elem => elem.muted = muteState);
        }
        document.querySelectorAll("audio").forEach(elem => elem.muted = {{ request.session.mute_state }});
    </script>
</html>
